cmake_minimum_required(VERSION 3.16)

set(CMAKE_CXX_STANDARD 17)

project(frost)

# This is necessary in order to use the file libsecp256k1-config.h, which is
# generated by the configure script of secp256k1.
# Among other things, this defines ECMULT_GEN_PREC_BITS.
add_compile_definitions(HAVE_CONFIG_H)

add_executable(
    frost
    main-frost.cpp
    frost_tests.cpp
    frost_utils.cpp
)

# MUXATOR 2022-08-30: libsecp256k1 caused a lot of warning of this type:
#
#     <base>/frost-experiment/build/secp256k1/include/group.h:167:13: warning: ‘secp256k1_ge_clear’ declared ‘static’ but never defined [-Wunused-function]
#      167 | static void secp256k1_ge_clear(secp256k1_ge *r);
#          |             ^~~~~~~~~~~~~~~~~~
#
# I've temporarily added "-Wno-unused-function" in order to give more prominence
# to the warnings generated by our code. Please remember to remove
# "-Wno-unused-function" and put in place the proper fixes.
target_compile_options(frost PRIVATE -Wall -Wextra -Wno-unused-function)

# Let's use -isystem instead of -I for secp256k1: this reduces the
# number of warnings generated by code not under our control and allows
# us to crank up the compiler strictness.
target_include_directories(frost PRIVATE
    ${USR_DIR}/include
    ${LIB_ITCOIN_PBFT_INCLUDE_PATH}
    ${THIRDPARTY_INCLUDE_PATH}
    ${GENERATED_INCLUDE_DIR}
)

target_link_libraries(
    frost
    ${LIB_ITCOIN_PBFT}
    ${THIRDPARTY_LIBRARIES}
    ${SQLite3_LIBRARIES}
    ${OPENSSL_LIBRARIES}
    ${CURL_LIBRARIES}
    Threads::Threads
)

#set(CMAKE_CXX_FLAGS_DEBUG "-g")

set(CMAKE_INSTALL_PREFIX ${CMAKE_BINARY_DIR})
install(TARGETS frost RUNTIME)
